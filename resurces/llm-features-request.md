# Фичи-реквест для LLM по экспорту данных из CRM в XML

## Планы реализации

1. **Структура архитектуры MVC**
   - Модели (Model): Student, Group, Organization
   - Представление (View): XML-документ
   - Контроллер (Controller): ExportController, EducatedPersonExporter

2. **Разбиение на компоненты**
   - DTO для инкапсуляции данных (StudentExportData)
   - Сборщики данных (DataCollectorInterface, StudentDataCollector)
   - Фабрики для создания XML (XmlDocumentFactory)
   - Валидаторы для проверки XML (XmlValidator)
   - Основной сервис экспорта (EducatedPersonExporter)

3. **Последовательность выполнения**
   - Получение списка групп
   - Для каждой группы получение списка студентов
   - Для каждого студента сбор данных из разных источников
   - Формирование XML-элементов для каждого студента
   - Добавление элементов в общий документ
   - Валидация финального XML-документа
   - Возврат XML-файла пользователю

## Маппинг данных между CRM и XML

| XML-поле | Источник данных в CRM |
|----------|------------------------|
| FullName | Student: firstName + lastName + middleName |
| SNILS | Student: snils |
| Profession | Group: profession |
| Workplace.Name | Group: workplace |
| Workplace.INN | Organization: inn |
| EducationalOrganization.Name | Константа: "Частное образовательное учреждение дополнительного профессионального образования "Учебный центр "РАКурс"" |
| EducationalOrganization.INN | Константа: "7610056871" |
| ProgramName | Group: educationProgram |
| ExaminationResult.Result | Константа: "удовлетворительно" |
| ExaminationResult.Date | Group: examDate |
| ExaminationResult.ProtocolNumber | Group: protocolNumber |

## Важные выводы

1. **Иммутабельность данных**
   - Использование readonly свойств для DTO (StudentExportData)
   - Метод withExamResult для создания новых экземпляров с измененными данными

2. **Валидация XML**
   - Необходимо проверять соответствие сгенерированного XML XSD-схеме
   - Желательно предоставлять подробные сообщения об ошибках для отладки

3. **Расширяемость**
   - Использование интерфейсов (DataCollectorInterface) для возможности подмены реализаций
   - Инъекция зависимостей через конструкторы для облегчения тестирования

4. **Производительность**
   - Для больших выборок данных следует использовать потоковую обработку
   - Возможно добавление постраничной выборки студентов при большом количестве данных

5. **Улучшения, которые можно добавить в будущем**
   - Асинхронная обработка для больших групп
   - Кэширование частых выборок
   - Логгирование процесса экспорта
   - Поддержка версионирования XML-схемы
   - Возможность экспорта по фильтрам (дата, программа обучения и т.д.)
   - Добавление прогресс-бара для отслеживания процесса экспорта на UI

6. **Требования к безопасности**
   - Проверка прав доступа перед экспортом данных
   - Санитизация данных перед добавлением в XML
   - Защита от инъекций XML-сущностей

7. **Общие практики для LLM при генерации кода**
   - Предпочтение readonly свойств для неизменяемых данных
   - Использование типизации для всех методов и свойств
   - Разделение кода на логические компоненты с единой ответственностью
   - Документирование публичного API
   - Следование принципам SOLID
